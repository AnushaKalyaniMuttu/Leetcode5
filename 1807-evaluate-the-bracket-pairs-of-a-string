import java.util.*;

public class Solution {

    public String evaluate(String s, List<List<String>> knowledge) {
        // Store key -> value mapping from knowledge
        Map<String, String> map = new HashMap<>();
        for (List<String> pair : knowledge) {
            map.put(pair.get(0), pair.get(1));
        }

        StringBuilder result = new StringBuilder();
        StringBuilder keyBuilder = new StringBuilder();

        boolean insideBracket = false;

        for (char ch : s.toCharArray()) {

            if (ch == '(') {
                insideBracket = true;
            } else if (ch == ')') {
                insideBracket = false;
                
                // Lookup key in map
                String key = keyBuilder.toString();
                result.append(map.getOrDefault(key, "?"));
                
                keyBuilder.setLength(0); // reset key builder
            } else {
                if (insideBracket) {
                    keyBuilder.append(ch);
                } else {
                    result.append(ch);
                }
            }
        }

        return result.toString();
    }

 
}
